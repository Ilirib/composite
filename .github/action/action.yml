name: Mirror Docs to Centralized Documentation
description: Composite action to mirror docs from a source repository to a centralized Documentation repository.
inputs:
  documentation_repository:
    description: 'Documentation repository in the format owner/repo'
    required: true
  documentation_pat:
    description: 'Personal Access Token with repo access'
    required: true
  source_directory:
    description: 'Name of the target directory in the Documentation repository (e.g. Infrastructure)'
    required: true
  target_directory:
    description: 'Path to the docs directory to mirror from'
    required: true
  documentation_checkout_path:
    description: 'Directory path where the documentation repository will be checked out'
    required: true
    default: 'documentation-temp'
runs:
  using: "composite"
  steps:
    - name: Checkout Source Repository
      uses: actions/checkout@v4
      with:
        path: main

    - name: Checkout Documentation Repository
      uses: actions/checkout@v4
      with:
        repository: ${{ inputs.documentation_repository }}
        token: ${{ inputs.documentation_pat }}
        path: ${{ inputs.documentation_checkout_path }}

    - name: Copy docs to Documentation Repository 
      shell: bash
      run: |
        mkdir -p ${{ inputs.documentation_checkout_path }}/docs/${{ inputs.source_directory }}
        rsync -av --delete ${{ inputs.target_directory }}/${{ inputs.documentation_checkout_path }}/docs/${{ inputs.source_directory }}/
      
    - name: Commit and push changes 
      shell: bash
      run: |
        cd ${{ inputs.documentation_checkout_path }}
        git config user.name "${GITHUB_ACTOR}"
        git config user.email "${GITHUB_ACTOR}@users.noreply.github.com"
        git add -A
        git diff-index --quiet HEAD || git commit -m "Docs changed in ${{ inputs.source_directory }} by ${GITHUB_ACTOR}"
        git push